<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Staff Dashboard - –î–Ω–µ–≤–Ω–∏–∫ —É—Å–ø–µ—Ö–∞</title>
  <link rel="stylesheet" href="static/css/staff.css" />
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
    }
    .staff-dashboard {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .staff-header {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .staff-header h1 {
      margin: 0;
      color: #333;
    }
    .staff-info {
      margin-top: 10px;
      color: #666;
    }
    .staff-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .logout-btn {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    .logout-btn:hover {
      background: #c0392b;
    }
  </style>
</head>
<body>
  <div class="staff-dashboard">
    <div class="staff-header">
      <h1>üîê Staff Dashboard</h1>
      <div class="staff-info">
        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è staff!</p>
        <p id="staff-user-info">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
      </div>
      <button class="logout-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
    </div>
    <div class="staff-content">
      <h2>–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
      <p>–ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç staff –ø–∞–Ω–µ–ª–∏.</p>
    </div>
  </div>

  <script>
    console.log('üîê Staff Dashboard: –ó–∞–≥—Ä—É–∑–∫–∞...');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
    const token = sessionStorage.getItem('access_token');
    console.log('üîç Staff Dashboard: –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω?', !!token);
    
    if (!token) {
      console.warn('‚ö†Ô∏è Staff Dashboard: –¢–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /staff/login');
      window.location.replace('/staff/login');
      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞
      throw new Error('–¢–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç');
    }

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    async function loadStaffInfo() {
      try {
        console.log('üì§ Staff Dashboard: –ó–∞–ø—Ä–æ—Å /api/staff/me...');
        const response = await fetch('/api/staff/me', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        console.log('üì• Staff Dashboard: –û—Ç–≤–µ—Ç /api/staff/me:', response.status);
        
        if (!response.ok) {
          if (response.status === 401) {
            // –¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω - —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≤—Ö–æ–¥
            console.warn('‚ö†Ô∏è Staff Dashboard: –¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–µ–Ω, —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /staff/login');
            sessionStorage.removeItem('access_token');
            window.location.replace('/staff/login');
            return;
          }
          throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é');
        }
        
        const data = await response.json();
        console.log('‚úÖ Staff Dashboard: –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', data);
        
        document.getElementById('staff-user-info').textContent = 
          `ID: ${data.id}, Phone: ${data.phone || 'N/A'}, Email: ${data.email || 'N/A'}, Role: ${data.role}`;
      } catch (error) {
        console.error('‚ùå Staff Dashboard: –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:', error);
        document.getElementById('staff-user-info').textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏';
        
        // –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≤—Ö–æ–¥
        if (error.message.includes('401') || error.message.includes('—Ç–æ–∫–µ–Ω')) {
          sessionStorage.removeItem('access_token');
          window.location.replace('/staff/login');
        }
      }
    }

    function logout() {
      console.log('üö™ Staff Dashboard: –í—ã—Ö–æ–¥...');
      sessionStorage.removeItem('access_token');
      window.location.replace('/staff/login');
    }

    // –î–µ–ª–∞–µ–º logout –¥–æ—Å—Ç—É–ø–Ω—ã–º –≥–ª–æ–±–∞–ª—å–Ω–æ
    window.logout = logout;

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    loadStaffInfo();
  </script>
</body>
</html>
