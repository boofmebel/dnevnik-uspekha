<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#1f2937" />
  <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –î–Ω–µ–≤–Ω–∏–∫ —É—Å–ø–µ—Ö–∞</title>
  <link rel="stylesheet" href="static/css/admin.css?v=1" />
  <script src="src/js/error-handler.js"></script>
  <script src="src/js/utils.js"></script>
  <script src="src/js/api.js"></script>
</head>
<body class="admin-body">
  <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ -->
  <div id="admin-loading" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: #1f2937; color: white; display: flex; align-items: center; justify-content: center; z-index: 9999; font-size: 1.5rem;">
    <div style="text-align: center;">
      <div style="font-size: 3rem; margin-bottom: 1rem;">üîê</div>
      <div>–ó–∞–≥—Ä—É–∑–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏...</div>
    </div>
  </div>
  <!-- –®–∞–ø–∫–∞ –∞–¥–º–∏–Ω–∫–∏ -->
  <header class="admin-header">
    <div class="admin-header-content">
      <div class="admin-header-left">
        <h1>üîê –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
      </div>
      <div class="admin-header-right">
        <span id="admin-user-email" class="admin-user-info"></span>
        <button class="admin-logout-btn" onclick="adminLogout()">–í—ã—Ö–æ–¥</button>
      </div>
    </div>
  </header>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <nav class="admin-nav">
    <button class="nav-btn active" data-page="dashboard" onclick="showAdminPage('dashboard')">
      üìä Dashboard
    </button>
    <button class="nav-btn" data-page="users" onclick="showAdminPage('users')">
      üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    </button>
    <button class="nav-btn" data-page="children" onclick="showAdminPage('children')">
      üëß –î–µ—Ç–∏
    </button>
    <button class="nav-btn" data-page="subscriptions" onclick="showAdminPage('subscriptions')">
      üí≥ –ü–æ–¥–ø–∏—Å–∫–∏
    </button>
    <button class="nav-btn" data-page="notifications" onclick="showAdminPage('notifications')">
      üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    </button>
  </nav>

  <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
  <main class="admin-main">
    <!-- Dashboard -->
    <div id="admin-page-dashboard" class="admin-page active">
      <div class="admin-page-header">
        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <button class="admin-refresh-btn" onclick="loadAdminStats()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>

      <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
      <div class="admin-stats-grid">
        <div class="admin-stat-card">
          <div class="stat-icon">üë•</div>
          <div class="stat-content">
            <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>
            <div class="stat-value" id="stat-total-users">-</div>
          </div>
        </div>
        <div class="admin-stat-card">
          <div class="stat-icon">üë®‚Äçüë©‚Äçüëß</div>
          <div class="stat-content">
            <div class="stat-label">–†–æ–¥–∏—Ç–µ–ª–µ–π</div>
            <div class="stat-value" id="stat-total-parents">-</div>
          </div>
        </div>
        <div class="admin-stat-card">
          <div class="stat-icon">üëß</div>
          <div class="stat-content">
            <div class="stat-label">–î–µ—Ç–µ–π</div>
            <div class="stat-value" id="stat-total-children">-</div>
          </div>
        </div>
        <div class="admin-stat-card">
          <div class="stat-icon">üí≥</div>
          <div class="stat-content">
            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫</div>
            <div class="stat-value" id="stat-active-subscriptions">-</div>
          </div>
        </div>
        <div class="admin-stat-card">
          <div class="stat-icon">üìã</div>
          <div class="stat-content">
            <div class="stat-label">–í—Å–µ–≥–æ –ø–æ–¥–ø–∏—Å–æ–∫</div>
            <div class="stat-value" id="stat-total-subscriptions">-</div>
          </div>
        </div>
        <div class="admin-stat-card">
          <div class="stat-icon">üí∞</div>
          <div class="stat-content">
            <div class="stat-label">–ó–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç</div>
            <div class="stat-value" id="stat-refund-requests">-</div>
          </div>
        </div>
      </div>

      <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
      <div class="admin-section">
        <h3>üë• –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h3>
        <div class="admin-table-container">
          <table class="admin-table" id="recent-users-table">
            <thead>
              <tr>
                <th>Email</th>
                <th>–†–æ–ª—å</th>
                <th>–î–µ—Ç–µ–π</th>
                <th>–ü–æ–¥–ø–∏—Å–æ–∫</th>
                <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody id="recent-users-tbody">
              <tr><td colspan="6" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ -->
      <div class="admin-section">
        <h3>üí≥ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏</h3>
        <div class="admin-table-container">
          <table class="admin-table" id="recent-subscriptions-table">
            <thead>
              <tr>
                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                <th>–ù–∞—á–∞–ª–æ</th>
                <th>–û–∫–æ–Ω—á–∞–Ω–∏–µ</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–í–æ–∑–≤—Ä–∞—Ç</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
              </tr>
            </thead>
            <tbody id="recent-subscriptions-tbody">
              <tr><td colspan="6" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
    <div id="admin-page-users" class="admin-page">
      <div class="admin-page-header">
        <h2>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</h2>
        <div class="admin-filters">
          <select id="users-role-filter" onchange="loadUsers()">
            <option value="">–í—Å–µ —Ä–æ–ª–∏</option>
            <option value="parent">–†–æ–¥–∏—Ç–µ–ª–∏</option>
            <option value="child">–î–µ—Ç–∏</option>
            <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã</option>
          </select>
          <input type="text" id="users-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ email..." onkeyup="debounceSearch(loadUsers, 300)()" />
        </div>
      </div>
      <div class="admin-table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Email</th>
              <th>–†–æ–ª—å</th>
              <th>–î–µ—Ç–µ–π</th>
              <th>–ü–æ–¥–ø–∏—Å–æ–∫</th>
              <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
              <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
          </thead>
          <tbody id="users-tbody">
            <tr><td colspan="7" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
          </tbody>
        </table>
      </div>
      <div class="admin-pagination">
        <button onclick="changeUsersPage(-1)">‚óÄ –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
        <span id="users-page-info">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1</span>
        <button onclick="changeUsersPage(1)">–°–ª–µ–¥—É—é—â–∞—è ‚ñ∂</button>
      </div>
    </div>

    <!-- –î–µ—Ç–∏ -->
    <div id="admin-page-children" class="admin-page">
      <div class="admin-page-header">
        <h2>üëß –î–µ—Ç–∏</h2>
        <button class="admin-refresh-btn" onclick="loadChildren()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
      </div>
      <div class="admin-table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>–ò–º—è</th>
              <th>–†–æ–¥–∏—Ç–µ–ª—å</th>
              <th>–ü–æ–ª</th>
              <th>–ó–∞–¥–∞—á</th>
              <th>–ó–≤—ë–∑–¥</th>
              <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
            </tr>
          </thead>
          <tbody id="children-tbody">
            <tr><td colspan="7" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
          </tbody>
        </table>
      </div>
      <div class="admin-pagination">
        <button onclick="changeChildrenPage(-1)">‚óÄ –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
        <span id="children-page-info">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1</span>
        <button onclick="changeChildrenPage(1)">–°–ª–µ–¥—É—é—â–∞—è ‚ñ∂</button>
      </div>
    </div>

    <!-- –ü–æ–¥–ø–∏—Å–∫–∏ -->
    <div id="admin-page-subscriptions" class="admin-page">
      <div class="admin-page-header">
        <h2>üí≥ –ü–æ–¥–ø–∏—Å–∫–∏</h2>
        <div class="admin-filters">
          <label>
            <input type="checkbox" id="subscriptions-active-only" onchange="loadSubscriptions()" />
            –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ
          </label>
        </div>
      </div>
      <div class="admin-table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
              <th>–ù–∞—á–∞–ª–æ</th>
              <th>–û–∫–æ–Ω—á–∞–Ω–∏–µ</th>
              <th>–°—Ç–∞—Ç—É—Å</th>
              <th>–í–æ–∑–≤—Ä–∞—Ç</th>
              <th>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
            </tr>
          </thead>
          <tbody id="subscriptions-tbody">
            <tr><td colspan="7" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
          </tbody>
        </table>
      </div>
      <div class="admin-pagination">
        <button onclick="changeSubscriptionsPage(-1)">‚óÄ –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
        <span id="subscriptions-page-info">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1</span>
        <button onclick="changeSubscriptionsPage(1)">–°–ª–µ–¥—É—é—â–∞—è ‚ñ∂</button>
      </div>
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="admin-page-notifications" class="admin-page">
      <div class="admin-page-header">
        <h2>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
        <div class="admin-filters">
          <select id="notifications-type-filter" onchange="loadNotifications()">
            <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
            <option value="subscription">–ü–æ–¥–ø–∏—Å–∫–∏</option>
            <option value="refund">–í–æ–∑–≤—Ä–∞—Ç—ã</option>
            <option value="complaint">–ñ–∞–ª–æ–±—ã</option>
            <option value="consent">–°–æ–≥–ª–∞—Å–∏—è</option>
            <option value="system">–°–∏—Å—Ç–µ–º–∞</option>
          </select>
        </div>
      </div>
      <div class="admin-table-container">
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
              <th>–¢–∏–ø</th>
              <th>–°–æ–æ–±—â–µ–Ω–∏–µ</th>
              <th>–°—Ç–∞—Ç—É—Å</th>
              <th>–î–∞—Ç–∞</th>
            </tr>
          </thead>
          <tbody id="notifications-tbody">
            <tr><td colspan="6" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
          </tbody>
        </table>
      </div>
      <div class="admin-pagination">
        <button onclick="changeNotificationsPage(-1)">‚óÄ –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
        <span id="notifications-page-info">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1</span>
        <button onclick="changeNotificationsPage(1)">–°–ª–µ–¥—É—é—â–∞—è ‚ñ∂</button>
      </div>
    </div>
  </main>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
  <div id="edit-user-modal" class="admin-modal">
    <div class="admin-modal-content">
      <div class="admin-modal-header">
        <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <button class="admin-modal-close" onclick="closeEditUserModal()">√ó</button>
      </div>
      <div class="admin-modal-body">
        <form id="edit-user-form" onsubmit="saveUser(event)">
          <input type="hidden" id="edit-user-id" />
          <div class="admin-form-group">
            <label>Email:</label>
            <input type="email" id="edit-user-email" required />
          </div>
          <div class="admin-form-group">
            <label>–†–æ–ª—å:</label>
            <select id="edit-user-role" required>
              <option value="parent">–†–æ–¥–∏—Ç–µ–ª—å</option>
              <option value="child">–†–µ–±—ë–Ω–æ–∫</option>
              <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
            </select>
          </div>
          <div class="admin-form-actions">
            <button type="button" class="admin-btn-secondary" onclick="closeEditUserModal()">–û—Ç–º–µ–Ω–∞</button>
            <button type="submit" class="admin-btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö -->
  <div id="admin-error-message" class="admin-error-message" style="display: none;"></div>
  <div id="admin-success-message" class="admin-success-message" style="display: none;"></div>

  <script src="src/js/admin.js"></script>
</body>
</html>

