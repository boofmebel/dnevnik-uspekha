# üì± –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞.

---

## üîß Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ú–æ–¥–µ–ª—å User
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `phone` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ, —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ)
- ‚úÖ –ü–æ–ª–µ `email` —Ç–µ–ø–µ—Ä—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ

**–§–∞–π–ª:** `backend/models/user.py`

### 2. –°—Ö–µ–º—ã
- ‚úÖ `RegisterRequest` - —Ç–µ–ø–µ—Ä—å —Ç—Ä–µ–±—É–µ—Ç `phone` –≤–º–µ—Å—Ç–æ `email`
- ‚úÖ `LoginRequest` - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Ö–æ–¥ –ø–æ email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—É

**–§–∞–π–ª:** `backend/schemas/auth.py`

### 3. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–æ–º–µ—Ä–∞: `+7XXXXXXXXXX`
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞
- ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–§–∞–π–ª:** `backend/core/utils/phone_validator.py`

### 4. AuthService
- ‚úÖ –ú–µ—Ç–æ–¥ `register()` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
- ‚úÖ –ú–µ—Ç–æ–¥ `authenticate()` - –≤—Ö–æ–¥ –ø–æ email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω—É

**–§–∞–π–ª:** `backend/services/auth_service.py`

### 5. UserRepository
- ‚úÖ –ú–µ—Ç–æ–¥ `get_by_phone()` - –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É

**–§–∞–π–ª:** `backend/repositories/user_repository.py`

---

## üé® Frontend

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ `frontend/register.html` - —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ `frontend/static/css/auth.css` - —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ `frontend/src/js/register.js` - –ª–æ–≥–∏–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞ –ø—Ä–∏ –≤–≤–æ–¥–µ: `(XXX) XXX-XX-XX`
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è (–º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
- ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ email
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

---

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é:
```
http://89.104.74.123:3000/register.html
```

### API Endpoint:
```
POST /api/auth/register
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "phone": "+79991234567",
  "password": "password123",
  "role": "parent",
  "email": "optional@email.com"  // –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "access_token": "jwt_token",
  "token_type": "bearer",
  "user": {
    "id": 1,
    "phone": "+79991234567",
    "email": "optional@email.com",
    "role": "parent"
  }
}
```

---

## üìã –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:

```bash
cd backend
psql -d your_database -f migrations/add_phone_to_users.sql
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Python:

```python
from sqlalchemy import text
from core.database import engine

async def run_migration():
    async with engine.begin() as conn:
        await conn.execute(text("""
            ALTER TABLE users 
            ADD COLUMN IF NOT EXISTS phone VARCHAR UNIQUE;
            
            CREATE INDEX IF NOT EXISTS ix_users_phone ON users(phone);
        """))
```

---

## üîç –§–æ—Ä–º–∞—Ç –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
- `+79991234567` ‚úÖ
- `79991234567` ‚úÖ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è +)
- `89991234567` ‚úÖ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ +7)
- `9991234567` ‚úÖ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è +7)

### –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:
–í—Å–µ –Ω–æ–º–µ—Ä–∞ –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ —Ñ–æ—Ä–º–∞—Ç—É: `+7XXXXXXXXXX` (12 —Å–∏–º–≤–æ–ª–æ–≤)

### –í–∞–ª–∏–¥–∞—Ü–∏—è:
- –î–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `+7`
- –ü–æ—Å–ª–µ `+7` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 10 —Ü–∏—Ñ—Ä
- –ò—Ç–æ–≥–æ: 12 —Å–∏–º–≤–æ–ª–æ–≤

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ API:

```javascript
const response = await fetch('/api/auth/register', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    phone: '+79991234567',
    password: 'mypassword123',
    role: 'parent'
  })
});
```

### –í—Ö–æ–¥ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É:

```javascript
const response = await fetch('/api/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    phone: '+79991234567',
    password: 'mypassword123'
  })
});
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Email –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π** - –º–æ–∂–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —Å —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º
2. **–¢–µ–ª–µ—Ñ–æ–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–π** - –Ω–µ–ª—å–∑—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–≤–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ —Å –æ–¥–Ω–∏–º –Ω–æ–º–µ—Ä–æ–º
3. **–ú–∏–≥—Ä–∞—Ü–∏—è –ë–î** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
4. **–§–æ—Ä–º–∞—Ç —Ç–µ–ª–µ—Ñ–æ–Ω–∞** - –≤—Å–µ –Ω–æ–º–µ—Ä–∞ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –∫ `+7XXXXXXXXXX`

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ü–∞—Ä–æ–ª—å —Ö–µ—à–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ bcrypt
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∏ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ HttpOnly cookies –¥–ª—è refresh —Ç–æ–∫–µ–Ω–æ–≤

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –û—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

