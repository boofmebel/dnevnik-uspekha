# üìã –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –ú–ò–ì–†–ê–¶–ò–ò –ò –ù–ê–°–¢–†–û–ô–ö–ï

## 1. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π Alembic

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```bash
cd backend
alembic current
```

### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π
```bash
cd backend
alembic upgrade head
```

### –û—Ç–∫–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```bash
cd backend
alembic downgrade -1
```

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
cd backend
alembic revision --autogenerate -m "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
```

## 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ SECRET_KEY

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
cd backend
python scripts/check_setup.py
```

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ .env —Ñ–∞–π–ª–µ
grep SECRET_KEY backend/.env

# –ò–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
echo $SECRET_KEY
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SECRET_KEY (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∫–ª—é—á–∞
python -c "import secrets; print(secrets.token_urlsafe(32))"

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ .env
echo "SECRET_KEY=–≤–∞—à-—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π-–∫–ª—é—á" >> backend/.env
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:
```bash
cd backend
python scripts/setup_secrets.py
```

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Redis –¥–ª—è rate limiting

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Redis (Ubuntu/Debian)
```bash
sudo apt-get update
sudo apt-get install redis-server
sudo systemctl start redis
sudo systemctl enable redis
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Redis (macOS)
```bash
brew install redis
brew services start redis
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Redis
```bash
redis-cli ping
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: PONG
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ

Redis —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `backend/core/middleware/rate_limit.py`:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Redis
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Redis, –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω
- Fallback –Ω–∞ in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –µ—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ REDIS_URL –≤ .env
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ backend/.env
REDIS_URL=redis://localhost:6379/0
```

## 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ endpoints

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
cd backend
uvicorn main:app --reload

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
cd backend
python scripts/test_endpoints.py
```

### –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ curl

#### Health check
```bash
curl http://localhost:8000/health
```

#### Ready check
```bash
curl http://localhost:8000/ready
```

#### Root endpoint
```bash
curl http://localhost:8000/
```

#### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–ø—Ä–∏–º–µ—Ä)
```bash
curl -X POST http://localhost:8000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "+79991234567",
    "name": "–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
    "password": "testpassword123"
  }'
```

## 5. –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
cd backend
python scripts/check_setup.py
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- ‚úÖ SECRET_KEY —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –∏–º–µ–µ—Ç –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—É—é –¥–ª–∏–Ω—É
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Redis –¥–æ—Å—Ç—É–ø–µ–Ω (–∏–ª–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ –Ω–µ—Ç)
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

## 6. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
cd backend
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### –ü—Ä–æ–¥–∞–∫—à–µ–Ω (—Å Gunicorn)
```bash
cd backend
gunicorn main:app -w 4 -k uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000
```

## 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

–õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ (–µ—Å–ª–∏ LOG_FORMAT=json –≤ .env):
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f logs/app.log  # –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ —Ñ–∞–π–ª–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```

## 8. Troubleshooting

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL –≤ .env
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –û—à–∏–±–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ë–î —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ: `alembic upgrade head --sql` –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ SQL

### Rate limiting –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω (–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è in-memory)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ slowapi —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: `pip install slowapi`

### CSRF –æ—à–∏–±–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ CSRF —Ç–æ–∫–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ X-CSRF-Token
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ cookies –≤–∫–ª—é—á–µ–Ω—ã –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö (credentials: 'include')

## 9. –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º

- [ ] SECRET_KEY —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª–∏–Ω–Ω—ã–π (–º–∏–Ω–∏–º—É–º 32 —Å–∏–º–≤–æ–ª–∞)
- [ ] DATABASE_URL –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] Redis –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã (`alembic upgrade head`)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ (JSON —Ñ–æ—Ä–º–∞—Ç)
- [ ] Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] CSRF –∑–∞—â–∏—Ç–∞ –≤–∫–ª—é—á–µ–Ω–∞
- [ ] HTTPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `*`)
- [ ] Debug endpoint –æ—Ç–∫–ª—é—á–µ–Ω (DEBUG=False)
- [ ] Health –∏ ready endpoints —Ä–∞–±–æ—Ç–∞—é—Ç

